# CLAUDE.md

## 実装ルール
1. 変更前に `rg` / `sed` で該当箇所を特定し、根拠行を確認する。
2. 最小差分で修正し、既存行を残したままの重複追記をしない。
3. HTMLの `id` を重複させない。
4. 「式を触らない」指定タスクでは、計算式・関数構造・イベント接続を変更しない。
5. 修正後は必ず検証コマンドを実行し、結果を確認する。

## 修正ログ

### 2026-02-13 19:57:19 KST
- 対象: `index.html`
- 目的: EV電卓中心の運用に合わせて UI と文言を整理し、1アクションEV(A/B/C)を追加。
- 実施:
  - `EV電卓` タブを追加し、初期表示タブを `EV電卓` に変更。
  - 機能A `コールEV（フォールド=0）` を追加（req / EV_call / E-req / 判定）。
  - 機能B `ベット損益分岐（1ストリート / Fold・Call 2択）` を追加。
    - 前提文を明記（Fold/Callのみ、Raiseなし、将来ストリート無視、チェック時期待値は自動計算しない）。
    - `1/3P, 1/2P, 2/3P, 1.0P` ボタンでB自動入力。
    - ベット単体EV式の定義コメントをJS内に明記。
  - 機能C `Outs → ヒット率` を追加（組合せ式の正確値 + 2/4近似）。
  - 下部ナビを5タブ化（EV電卓/プリフロップ/ICM/トレーナー/設定）。
  - 主要計算ボタン行を sticky 化（モバイル操作性向上）。
- 検証:
  - 重複ID検査、禁止語句残骸、主要ID出現を確認。

### 2026-02-13 20:09:00 KST
- ミス: 機能Bを「Bet vs Check」等と誤表記して誤認を誘発した
- ミス: ラベル修正なのに追記して二重化/重複idを作る危険があった
- ミス: 未導入コマンド(rg/node)前提で検証ログを書いた
- 再発防止: grep/python3のみで必須検証を固定し、実行ログをそのまま貼る

### 2026-02-13 21:51:04 KST
- ミス: 機能Bを「Bet vs Check」と表記し、チェックEVを計算しているように誤解させた
- ミス: 機能Bの前提（Fold/Callのみ・将来ストリート無視・E_called固定）をUIに固定表示せず、一般のベットEVに見せた
- ミス: ラベル修正時に“置換”ではなく“追記”して見出し/ラベルが二重化するリスクを作った
- 再発防止: コミット前に「禁止語rg 0件」+「duplicate idチェック OK」を必須化（このログをCLAUDE.mdに毎回残す）
